{\rtf1\ansi\ansicpg1252\cocoartf1671\cocoasubrtf600
{\fonttbl\f0\fmodern\fcharset0 Courier;}
{\colortbl;\red255\green255\blue255;\red26\green26\blue26;\red254\green254\blue254;}
{\*\expandedcolortbl;;\cssrgb\c13333\c13333\c13333;\cssrgb\c99608\c99608\c99608;}
\margl1440\margr1440\vieww10800\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs20 \cf2 \cb3 \expnd0\expndtw0\kerning0
In the static analysis we will analysis the xmlrpc.php file. \cb1 \
\
\cb3 Line (73 - 82)\cb1 \
\
\cb3 This code check if the user have enough privileges.\cb1 \
\
\cb3 $user_entry = getUserEntry($username);\cb1 \
\cb3     /*\cb1 \
\cb3      * admin (uid = 0) is allowed \cb1 \
\cb3      * or regular user with necessary privilege\cb1 \
\cb3      */\cb1 \
\cb3     if (isset($user_entry['uid']) && $user_entry['uid'] != '0' &&\cb1 \
\cb3         !userHasPrivilege($user_entry, 'system-xmlrpc-ha-sync')) \{\cb1 \
\cb3       log_auth("webConfigurator authentication error for '" .\cb1 \
\cb3           $username . "' from " . $this->remote_addr .\cb1 \
\cb3           " not enough privileges");\cb1 \
\cb3         \
\
Line (137 - 146)\cb1 \
\
\cb3 This part of code is the interest for us.\cb1 \
\
\cb3 As we can see, first we have a check for auth then we have the dangerous function (eval) which take as parametere ($code).\cb1 \
\
\cb3   public function exec_php($code) \{\cb1 \
\cb3     $this->auth();\cb1 \
\
\cb3     eval($code);\cb1 \
\cb3     if ($toreturn) \{\cb1 \
\cb3       return $toreturn;\cb1 \
\cb3     \}\cb1 \
\
\cb3     return true;\cb1 \
\cb3   \}\cb1 \
\cb3   \cb1 \
\cb3 Line (155 - 160)\cb1 \
\
\cb3 In this part of code also we have a check for auth then the execution for ($code)\cb1 \
\cb3   \cb1 \
\cb3   public function exec_shell($code) \{\cb1 \
\cb3     $this->auth();\cb1 \
\
\cb3     mwexec($code);\cb1 \
\cb3     return true;\cb1 \
\cb3   \}\cb1 \
\cb3   }